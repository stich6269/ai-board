const WebSocket = require('ws');

// –û—Å–Ω–æ–≤–Ω–æ–π WebSocket Hyperliquid
const WS_URL = 'wss://api.hyperliquid.xyz/ws';

console.log(`üîå –ü–æ–¥–∫–ª—é—á–∞—é—Å—å –∫ ${WS_URL}...`);
const ws = new WebSocket(WS_URL);

ws.on('open', () => {
    console.log('‚úÖ –°–æ–µ–¥–∏–Ω–µ–Ω–∏–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ. –ù–∞—á–∏–Ω–∞–µ–º —Ç–µ—Å—Ç Ping-Pong...');
    console.log('–ü–æ—Å—ã–ª–∞–µ–º —Å–∏–≥–Ω–∞–ª -> –°–µ—Ä–≤–µ—Ä –æ—Ç—Ä–∞–∂–∞–µ—Ç -> –ü–æ–ª—É—á–∞–µ–º –æ–±—Ä–∞—Ç–Ω–æ');
    console.log('-------------------------------------------------------');

    // –ó–∞–ø—É—Å–∫–∞–µ–º —Ç–µ—Å—Ç –∫–∞–∂–¥—É—é —Å–µ–∫—É–Ω–¥—É
    setInterval(() => {
        const start = Date.now();

        // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º heartbeat-–∑–∞–ø—Ä–æ—Å (—Å–µ—Ä–≤–µ—Ä –æ–±—è–∑–∞–Ω –æ—Ç–≤–µ—Ç–∏—Ç—å –Ω–∞ –Ω–µ–≥–æ)
        // Hyperliquid –æ—Ç–≤–µ—á–∞–µ—Ç –Ω–∞ { "method": "ping" } —Å–æ–æ–±—â–µ–Ω–∏–µ–º { "data": "pong" }
        ws.send(JSON.stringify({ method: "ping" }));

        // –ñ–¥–µ–º –ø–µ—Ä–≤—ã–π –æ—Ç–≤–µ—Ç
        ws.once('message', (data) => {
            const end = Date.now();
            const rtt = end - start; // –í—Ä–µ–º—è —Ç—É–¥–∞-–æ–±—Ä–∞—Ç–Ω–æ
            const oneWay = (rtt / 2).toFixed(1); // –ü—Ä–∏–º–µ—Ä–Ω–æ–µ –≤—Ä–µ–º—è –≤ –æ–¥–Ω—É —Å—Ç–æ—Ä–æ–Ω—É

            // –û—Ü–µ–Ω–∫–∞ –∫–∞—á–µ—Å—Ç–≤–∞
            let status = '';
            if (rtt < 80) status = 'üöÄ –ò–î–ï–ê–õ–¨–ù–û (VPS –Ω–µ –Ω—É–∂–µ–Ω)';
            else if (rtt < 150) status = '‚úÖ –•–û–†–û–®–û (–ú–æ–∂–Ω–æ —Ç–æ—Ä–≥–æ–≤–∞—Ç—å)';
            else if (rtt < 250) status = '‚ö†Ô∏è –ù–ê –ì–†–ê–ù–ò (–õ—É—á—à–µ VPS)';
            else status = '‚ùå –ü–õ–û–•–û (–°—Ä–æ—á–Ω–æ –Ω–∞ VPS)';

            // –ö—Ä–∞—Å–∏–º –≤—ã–≤–æ–¥ –¥–ª—è –Ω–∞–≥–ª—è–¥–Ω–æ—Å—Ç–∏ (–µ—Å–ª–∏ –∫–æ–Ω—Å–æ–ª—å –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç —Ü–≤–µ—Ç–∞)
            const color = rtt < 150 ? '\x1b[32m' : '\x1b[31m'; // –ó–µ–ª–µ–Ω—ã–π –∏–ª–∏ –ö—Ä–∞—Å–Ω—ã–π
            const reset = '\x1b[0m';

            console.log(`${color}‚è±Ô∏è RTT: ${rtt}ms ${reset}| One-Way: ~${oneWay}ms | ${status}`);
        });

    }, 1000);
});

ws.on('error', (err) => {
    console.error('‚ùå –û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è:', err.message);
});

ws.on('close', () => {
    console.log('üîå –°–æ–µ–¥–∏–Ω–µ–Ω–∏–µ —Ä–∞–∑–æ—Ä–≤–∞–Ω–æ');
    process.exit(0);
});
